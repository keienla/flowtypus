(function(_,h){typeof exports=="object"&&typeof module<"u"?module.exports=h():typeof define=="function"&&define.amd?define(h):(_=typeof globalThis<"u"?globalThis:_||self,_.flowtypus=h())})(this,function(){"use strict";var Yr=Object.defineProperty;var Zr=(_,h,f)=>h in _?Yr(_,h,{enumerable:!0,configurable:!0,writable:!0,value:f}):_[h]=f;var y=(_,h,f)=>(Zr(_,typeof h!="symbol"?h+"":h,f),f);var _={},h={},f={};Object.defineProperty(f,"__esModule",{value:!0});function Be(e,n,t=[]){const r=n||0;return function(...i){const o=[...t,...i];return e.length-o.length<=0&&o.length>=r?e(...o):Be(e,n,o)}}f.default=Be,Object.defineProperty(h,"__esModule",{value:!0});const jt=f;h.default=(0,jt.default)(function(n,t){return n+t});var ce={},se={},K={},E={};Object.defineProperty(E,"__esModule",{value:!0});function mt(e){return function(...t){for(var r=e(...t);r instanceof Function;)r=r();return r}}E.default=mt,Object.defineProperty(K,"__esModule",{value:!0});const wt=E,At=f;K.default=(0,At.default)(function(n,t,r,u,i){const o=(c,s,d,b,j=null)=>!s||!s.length||d===j?d:()=>o(c,s.slice(1),c(d,s[0](b)),b,j);return(0,wt.default)(o)(n,t,r,u,i)}),Object.defineProperty(se,"__esModule",{value:!0});const Pt=f,$t=K;se.default=(0,Pt.default)(function(n,t,r){return(0,$t.default)((u,i)=>u&&i,[n,t],!0,r,!1)}),Object.defineProperty(ce,"__esModule",{value:!0});const Mt=se;function Rt(...e){return(0,Mt.default)(...e)}ce.default=Rt;var G={},D={},N={},U={},H={},m={},p={},k={};Object.defineProperty(k,"__esModule",{value:!0});function Et(e){return Object.freeze(e)}k.default=Et,Object.defineProperty(p,"__esModule",{value:!0}),p._generatorReduce=p._objectReduce=p._arrayReduce=void 0;const Ke=k,ae=E,fe=f;p._arrayReduce=(0,fe.default)(function(n,t,r){if(!r||r.length===0)return t;function u(i,o,c){return o>=c.length?i:()=>u(n(i,c[o],o,(0,Ke.default)(c)),o+1,c)}return(0,ae.default)(u)(t!==void 0?t:r[0],t!==void 0?0:1,r)}),p._objectReduce=(0,fe.default)(function(n,t,r){const u=Object.keys(r);if(!r||u.length===0)return t;function i(o,c,s,d){return c>=s.length?o:()=>i(n(o,d[s[c]],s[c],(0,Ke.default)(d)),c+1,s,d)}return(0,ae.default)(i)(t!==void 0?t:r[u[0]],t!==void 0?0:1,u,r)}),p._generatorReduce=(0,fe.default)(function(n,t,r){if(!r)return t;if(t===void 0){const i=r.next();if(i.done)return t;t=i.value}function u(i,o){const c=o.next();return c.done?i:()=>u(n(i,c.value),o)}return(0,ae.default)(u)(t,r)}),Object.defineProperty(m,"__esModule",{value:!0});const St=p;function Tt(...e){return(0,St._arrayReduce)(...e)}m.default=Tt,Object.defineProperty(H,"__esModule",{value:!0});const It=m;function Lt(e){return function(...t){return(0,It.default)((r,u,i)=>i===t.length-1?r[0](...r[1],u):r[0].length===[...r[1],u].length?[r[0](...r[1],u),[]]:[r[0],[...r[1],u]],[e,[]],t)}}H.default=Lt,Object.defineProperty(U,"__esModule",{value:!0});const Ft=H;function Nt(e){return function(...t){return!(0,Ft.default)(e)(...t)}}U.default=Nt;var W={},q={},S={};Object.defineProperty(S,"__esModule",{value:!0});function Ut(e){return e===null?"null":e===void 0?"undefined":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}S.default=Ut,Object.defineProperty(q,"__esModule",{value:!0});const kt=S;function qt(e){switch((0,kt.default)(e)){case"array":case"function":case"string":return e.length;case"object":return Object.keys(e).length;case"regexp":return e.toString().length;default:return null}}q.default=qt,Object.defineProperty(W,"__esModule",{value:!0});const Ge=q,Ct=f;W.default=(0,Ct.default)(function(n,t){const r=(0,Ge.default)(n),u=(0,Ge.default)(t);return r===null||u===null?!1:r===u}),Object.defineProperty(N,"__esModule",{value:!0});const zt=U,Bt=W;N.default=(0,zt.default)(Bt.default);var X={},J={},Q={},Y={},Z={},De;function Kt(){if(De)return Z;De=1,Object.defineProperty(Z,"__esModule",{value:!0});const e=U,n=V(),t=f,r=H;return Z.default=(0,t.default)(function(i,o){return(0,e.default)((0,r.default)(n.default))(i,o)}),Z}var He;function We(){if(He)return Y;He=1,Object.defineProperty(Y,"__esModule",{value:!0});const e=Kt();function n(...t){return(0,e.default)(...t)}return Y.default=n,Y}var Xe;function Je(){if(Xe)return Q;Xe=1,Object.defineProperty(Q,"__esModule",{value:!0});const e=f,n=N,t=We(),r=(0,e.default)(function(i,o){if((0,n.default)(i,o))return!1;if(i===o)return!0;const c=Object.keys(i);for(let s of c)if(!(s in o)||(0,t.default)(i[s],o[s]))return!1;return!0});return Q.default=r,Q}var Qe;function Gt(){if(Qe)return J;Qe=1,Object.defineProperty(J,"__esModule",{value:!0});const e=f,n=S,t=xe(),r=Je();return J.default=(0,e.default)(function(i,o){if((0,n.default)(i)!==(0,n.default)(o))return!1;switch((0,n.default)(i)){case"array":return(0,t.default)(i,o);case"object":return(0,r.default)(i,o);case"function":case"regexp":return i.toString()===o.toString();default:return i===o}}),J}var Ye;function V(){if(Ye)return X;Ye=1,Object.defineProperty(X,"__esModule",{value:!0});const e=Gt();function n(...t){return(0,e.default)(...t)}return X.default=n,X}var Ze;function Dt(){if(Ze)return D;Ze=1,Object.defineProperty(D,"__esModule",{value:!0});const e=f,n=N,t=V(),r=E;return D.default=(0,e.default)(function(i,o){if((0,n.default)(i,o))return!1;if(i===o)return!0;const c=(s=!0,d=0)=>s?d===i.length?s:()=>c((0,t.default)(i[d],o[d]),d+1):!1;return(0,r.default)(c)()}),D}var Ve;function xe(){if(Ve)return G;Ve=1,Object.defineProperty(G,"__esModule",{value:!0});const e=Dt();function n(...t){return(0,e.default)(...t)}return G.default=n,G}var de={},x={},ee={};Object.defineProperty(ee,"__esModule",{value:!0});function Ht(e){return function(t){return t&&t.length?e(...t):e()}}ee.default=Ht,Object.defineProperty(x,"__esModule",{value:!0});const Wt=ee,Xt=m;function Jt(...e){return function(...t){return e[0]=(0,Wt.default)(e[0]),(0,Xt.default)(function(u,i){return i(u)},t,e||[])}}x.default=Jt,Object.defineProperty(de,"__esModule",{value:!0});const Qt=x;function Yt(...e){return(0,Qt.default)(...e.reverse())}de.default=Yt;var le={};Object.defineProperty(le,"__esModule",{value:!0});function Zt(e){return function(){return e}}le.default=Zt;var _e={},te={},w={};Object.defineProperty(w,"__esModule",{value:!0}),w._whenElse=w._when=void 0;const et=f;w._when=(0,et.default)(function(n,t){return tt(n,t)}),w._whenElse=(0,et.default)(function(n,t,r){return tt(n,t,r)});function tt(e,n,t){return function(u){return e(u)?n(u):t?t(u):u}}Object.defineProperty(te,"__esModule",{value:!0});const Vt=w;function xt(...e){return(0,Vt._when)(...e)}te.default=xt;var ne={},ye={};Object.defineProperty(ye,"__esModule",{value:!0});const en=f,tn=K;ye.default=(0,en.default)(function(n,t,r){return(0,tn.default)((u,i)=>u||i,[n,t],!1,r,!0)}),Object.defineProperty(ne,"__esModule",{value:!0});const nn=ye;function rn(...e){return(0,nn.default)(...e)}ne.default=rn;var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.isNull=a.isUndefined=a.isRegexp=a.isFunction=a.isBigint=a.isSymbol=a.isBoolean=a.isNumber=a.isString=a.isObject=a.isGeneratorFunction=a.isGenerator=a.isArray=void 0;const un=S,g=(0,f.default)(function(n,t){return(0,un.default)(t)===n});a.default=g;function on(e){return g("array",e)}a.isArray=on;function cn(e){return g("generator",e)}a.isGenerator=cn;function sn(e){return g("generatorfunction",e)}a.isGeneratorFunction=sn;function an(e){return g("object",e)}a.isObject=an;function fn(e){return g("string",e)}a.isString=fn;function dn(e){return g("number",e)}a.isNumber=dn;function ln(e){return g("boolean",e)}a.isBoolean=ln;function _n(e){return g("symbol",e)}a.isSymbol=_n;function yn(e){return g("bigint",e)}a.isBigint=yn;function hn(e){return g("function",e)}a.isFunction=hn;function gn(e){return g("regexp",e)}a.isRegexp=gn;function bn(e){return g("undefined",e)}a.isUndefined=bn;function vn(e){return g("null",e)}a.isNull=vn;var re={},A={},C={};Object.defineProperty(C,"__esModule",{value:!0});const pn=p;function On(...e){return(0,pn._objectReduce)(...e)}C.default=On,Object.defineProperty(A,"__esModule",{value:!0}),A._objectMap=A._arrayMap=void 0;const nt=m,jn=C,rt=f;A._arrayMap=(0,rt.default)(function(n,t){return!t||t.length===0?[]:(0,nt.default)(function(u,i,o,c){return[...u,n(i,o,c)]},[],t)}),A._objectMap=(0,rt.default)(function(n,t){if(!t)return{};const r=Object.keys(t);return r.length===0?{}:(0,jn.default)(function(i,o,c,s){return Object.assign(Object.assign({},i),{[c]:n(o,c,s)})},(0,nt.default)(function(i,o){return Object.assign(Object.assign({},i),{[o]:void 0})},{},r),t)}),Object.defineProperty(re,"__esModule",{value:!0});const mn=A;function wn(...e){return(0,mn._objectMap)(...e)}re.default=wn,Object.defineProperty(_e,"__esModule",{value:!0});const ut=k,An=te,Pn=ne,it=a,$n=re;function Mn(e){return(0,ut.default)((0,$n.default)((0,An.default)((0,Pn.default)(it.isArray,it.isObject),ut.default),e))}_e.default=Mn;var he={};Object.defineProperty(he,"__esModule",{value:!0});const Rn=f;he.default=(0,Rn.default)(function(n,t){if(t===0)throw new Error(`Can't divide by "0"`);return n/t});var ge={},P={};Object.defineProperty(P,"__esModule",{value:!0}),P._objectFilter=P._arrayFilter=void 0;const En=m,Sn=C,ot=f;P._arrayFilter=(0,ot.default)(function(n,t){return(0,En.default)(function(u,i,o,c){return n(i,o,c)?[...u,i]:u},[],t)}),P._objectFilter=(0,ot.default)(function(n,t){return(0,Sn.default)(function(u,i,o,c){return n(i,o,c)?Object.assign(Object.assign({},u),{[o]:c[o]}):u},{},t)}),Object.defineProperty(ge,"__esModule",{value:!0});const Tn=P;function In(...e){return(0,Tn._arrayFilter)(...e)}ge.default=In;var be={};Object.defineProperty(be,"__esModule",{value:!0});const Ln=P;function Fn(...e){return(0,Ln._objectFilter)(...e)}be.default=Fn;var ve={};Object.defineProperty(ve,"__esModule",{value:!0});function Nn(e){return function(t,r,...u){return e(r,t,...u)}}ve.default=Nn;var pe={};Object.defineProperty(pe,"__esModule",{value:!0});function Un(e){return e}pe.default=Un;var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});const kn=f,qn=q,Cn=(0,kn.default)(function(n,t){return(0,qn.default)(t)===n});Oe.default=Cn;var je={};Object.defineProperty(je,"__esModule",{value:!0});const zn=A;function Bn(...e){return(0,zn._arrayMap)(...e)}je.default=Bn;var me={};Object.defineProperty(me,"__esModule",{value:!0});const Kn=V();function Gn(e){let n={};return function(...r){const u=Object.keys(n);for(let i of u)if((0,Kn.default)(n[i].args,r))return n[i].value;return n=Object.assign(Object.assign({},n),{[u.length.toString()]:{args:r,value:e(...r)}}),n[u.length.toString()].value}}me.default=Gn;var we={};Object.defineProperty(we,"__esModule",{value:!0});const Dn=f;we.default=(0,Dn.default)(function(n,t){return n*t});var Ae={};Object.defineProperty(Ae,"__esModule",{value:!0});function Hn(e,...n){return function(...r){return e(...n,...r)}}Ae.default=Hn;var Pe={},$e={};Object.defineProperty($e,"__esModule",{value:!0});const Wn=f;$e.default=(0,Wn.default)(function(n,t=[]){var r={};for(let u of t)r[u]=n[u];return r}),Object.defineProperty(Pe,"__esModule",{value:!0});const Xn=$e;function Jn(...e){return(0,Xn.default)(...e)}Pe.default=Jn;var Me={};Object.defineProperty(Me,"__esModule",{value:!0});function Qn(e){return Object.assign({},e)}Me.default=Qn;var Re={};Object.defineProperty(Re,"__esModule",{value:!0});function Yn(e){return function(...t){return e(...t.reverse())}}Re.default=Yn;var Ee={};Object.defineProperty(Ee,"__esModule",{value:!0});function Zn(e){return function(...t){return t.length?e(t):e()}}Ee.default=Zn;var Se={};Object.defineProperty(Se,"__esModule",{value:!0});const Vn=f;Se.default=(0,Vn.default)(function(n,t){return n-t});var Te={};Object.defineProperty(Te,"__esModule",{value:!0});const xn=w;function er(...e){return(0,xn._whenElse)(...e)}Te.default=er,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.substract=e.spreadArgs=e.sameLength=e.reverseArgs=e.reduceObject=e.reduce=e.pipe=e.pickAll=e.pick=e.partial=e.or=e.objectIs=e.notSameLength=e.not=e.multiply=e.memoize=e.mapObject=e.map=e.length=e.isNull=e.isUndefined=e.isRegexp=e.isFunction=e.isBigint=e.isSymbol=e.isBoolean=e.isNumber=e.isString=e.isObject=e.isGeneratorFunction=e.isGenerator=e.isArray=e.isType=e.isnt=e.isLength=e.is=e.identity=e.gatherArgs=e.freeze=e.flipArgs=e.filterObject=e.filter=e.divide=e.deepFreeze=e.curry=e.constant=e.compose=e.arrayIs=e.and=e.add=void 0,e.whenElse=e.when=e.type=e.transpoline=void 0;const n=h;e.add=n.default;const t=ce;e.and=t.default;const r=xe();e.arrayIs=r.default;const u=de;e.compose=u.default;const i=le;e.constant=i.default;const o=f;e.curry=o.default;const c=_e;e.deepFreeze=c.default;const s=he;e.divide=s.default;const d=ge;e.filter=d.default;const b=be;e.filterObject=b.default;const j=ve;e.flipArgs=j.default;const L=k;e.freeze=L.default;const F=ee;e.gatherArgs=F.default;const ze=pe;e.identity=ze.default;const wr=V();e.is=wr.default;const Ar=Oe;e.isLength=Ar.default;const Pr=We();e.isnt=Pr.default;const $r=a;e.isType=$r.default;const v=a;Object.defineProperty(e,"isArray",{enumerable:!0,get:function(){return v.isArray}}),Object.defineProperty(e,"isGenerator",{enumerable:!0,get:function(){return v.isGenerator}}),Object.defineProperty(e,"isGeneratorFunction",{enumerable:!0,get:function(){return v.isGeneratorFunction}}),Object.defineProperty(e,"isObject",{enumerable:!0,get:function(){return v.isObject}}),Object.defineProperty(e,"isString",{enumerable:!0,get:function(){return v.isString}}),Object.defineProperty(e,"isNumber",{enumerable:!0,get:function(){return v.isNumber}}),Object.defineProperty(e,"isBoolean",{enumerable:!0,get:function(){return v.isBoolean}}),Object.defineProperty(e,"isSymbol",{enumerable:!0,get:function(){return v.isSymbol}}),Object.defineProperty(e,"isBigint",{enumerable:!0,get:function(){return v.isBigint}}),Object.defineProperty(e,"isFunction",{enumerable:!0,get:function(){return v.isFunction}}),Object.defineProperty(e,"isRegexp",{enumerable:!0,get:function(){return v.isRegexp}}),Object.defineProperty(e,"isUndefined",{enumerable:!0,get:function(){return v.isUndefined}}),Object.defineProperty(e,"isNull",{enumerable:!0,get:function(){return v.isNull}});const Mr=q;e.length=Mr.default;const Rr=je;e.map=Rr.default;const Er=re;e.mapObject=Er.default;const Sr=me;e.memoize=Sr.default;const Tr=we;e.multiply=Tr.default;const Ir=U;e.not=Ir.default;const Lr=N;e.notSameLength=Lr.default;const Fr=Je();e.objectIs=Fr.default;const Nr=ne;e.or=Nr.default;const Ur=Ae;e.partial=Ur.default;const kr=Pe;e.pick=kr.default;const qr=Me;e.pickAll=qr.default;const Cr=x;e.pipe=Cr.default;const zr=m;e.reduce=zr.default;const Br=C;e.reduceObject=Br.default;const Kr=Re;e.reverseArgs=Kr.default;const Gr=W;e.sameLength=Gr.default;const Dr=Ee;e.spreadArgs=Dr.default;const Hr=Se;e.substract=Hr.default;const Wr=E;e.transpoline=Wr.default;const Xr=S;e.type=Xr.default;const Jr=te;e.when=Jr.default;const Qr=Te;e.whenElse=Qr.default}(_);const tr=new window.DOMParser,ct="data-flowtypus-container",st="data-flowtypus-view",at="data-flowtypus-target-template",Ie="data-flowtypus-old-view",Le="data-flowtypus-new-view",nr="data-flowtypus-disabled",ft="data-flowtypus-reload",$=[],M=new Map,dt=[],T=new Map,l={previousTemplate:null,transitions:new Map,state:"end",previousURL:null},Fe={out:async e=>{var t;window.scrollTo({top:0,behavior:"smooth"});const n=(t=e.from.view)==null?void 0:t.animate([{opacity:1},{opacity:0}],{duration:200,iterations:1,fill:"forwards",easing:"ease-out"});return n==null||n.play(),(n==null?void 0:n.finished)||Promise.resolve()},in:async e=>{var t;e.from.view&&(e.from.view.style.position="absolute");const n=(t=e.to.view)==null?void 0:t.animate([{opacity:0},{opacity:1}],{duration:200,iterations:1,fill:"forwards",easing:"ease-in"});return n==null||n.play(),(n==null?void 0:n.finished)||Promise.resolve()}},Ne={out:async()=>Promise.resolve(),in:async()=>Promise.resolve()};function rr(e,n,t=(r,u)=>r===u){e||(e=[]),n||(n=[]);const r=e.length>n.length?"added":"missing",u=r==="added"?"missing":"added",i=r==="added"?n:e,o={missing:r==="added"?[...e]:[],commun:[],added:r==="missing"?[...n]:[]};for(let c=0,s=i.length;c<s;c++){const d=i[c],b=o[u].findIndex(j=>t(j,d));b===-1?o[r].push(d):(o.commun.push(d),o[u].splice(b,1))}return o}function ue(e,n,t=!0){var i;e||(e="*"),n||(n="*");const r=(i=window==null?void 0:window.matchMedia)!=null&&i.call(window,"(prefers-reduced-motion: reduce)").matches?" (reduced)":"",u=[`${e} => ${n}${r}`,`${n} <= ${e}${r}`,`${e} <=> ${n}${r}`];return e!==n&&u.push(`${n} <=> ${e}${r}`),n!=="*"&&t&&u.push(...ue(e,"*",!1)),e!=="*"&&t&&u.push(...ue("*",n,!1)),e!=="*"&&n!=="*"&&t&&u.push(...ue("*","*",!1)),u}function O(e,n){if(!e)return null;if(e instanceof URL)return e;try{return new URL(e)}catch{try{return new URL(e,n||window.location.href)}catch{return null}}}function R(){return O(window.location.href)}function ie(e){return e instanceof URL}function Ue(e,n){return e=O(e),n=O(n),ie(e)&&ie(n)&&e.origin===n.origin}function ur(e,n){return e=O(e),n=O(n),ie(e)&&ie(n)&&e.pathname===n.pathname&&e.search===n.search}function lt(e){return e?e.tagName==="A"?e:e.parentElement?lt(e.parentElement):null:null}function ir(e){return e instanceof Document?e:tr.parseFromString(typeof e=="string"?e:e.toString(),"text/html")}function z(e){return!e||!(e instanceof Document)?null:e.querySelector(`[${ct}]`)||null}function B(e){var n;return Array.from(((n=z(e))==null?void 0:n.children)||[]).filter(t=>t.hasAttribute(st)&&!t.hasAttribute(Ie))[0]||null}function ke(e){var t;const n=B(e);return((t=n==null?void 0:n.getAttribute)==null?void 0:t.call(n,st))||null}function or(e){return!e||!(e instanceof HTMLElement)?null:e.hasAttribute(at)&&e.getAttribute(at)||null}function _t(e,n,t,r=""){var u,i;!!n&&n.getAttribute(t)!==((u=e==null?void 0:e.getAttribute)==null?void 0:u.call(e,t))&&n.setAttribute(t,((i=e==null?void 0:e.getAttribute)==null?void 0:i.call(e,t))||r)}const cr=_.curry(function(n,t){const r=t.children[0],u=n.children[0];return _t(u,r,"lang"),_t(u,r,"dir","ltr"),t}),sr=_.curry(function(n,t){const r=Array.from(t.head.children),u=Array.from(n.head.children),{missing:i,added:o}=rr(r,u,(c,s)=>c.isEqualNode(s));return i.forEach(c=>c.remove()),t.head.append(...o),o.filter(c=>c.tagName==="SCRIPT").forEach(c=>qe(c)),t}),ar=_.curry(function(n,t){let r=z(t);if(!r)throw new Error('no container with attribute "'+ct+'"');let u=B(t),i=B(n);if(!u)throw new Error("No view with attribute");if(!u||!i)throw new Error("No content");return i.setAttribute(Le,"true"),u.setAttribute(Ie,"true"),u.nextSibling?r.insertBefore(i,u.nextSibling):r.append(i),t});function fr(e){const n=e.querySelector(`[${Ie}]`);n==null||n.remove();const t=e.querySelector(`[${Le}]`);return t==null||t.removeAttribute(Le),e}function dr(e=document){return Array.from(e.querySelectorAll(`a:not([${nr}]):not([href^="#"])`)).filter(n=>Ue(n.getAttribute("href"),window.location.href)?n.hasAttribute("target")?n.getAttribute("target")==="_self":!0:!1)}function lr(e=document){const n=e.head.querySelectorAll(`script[${ft}]`),t=e.body.querySelectorAll(`script[${ft}]`);return[...Array.from(n),...Array.from(t)]}function qe(e){const n=document.createElement("script"),t=Array.from(e.attributes);for(const{name:r,value:u}of t)n[r]=u;n.append(e.textContent||""),e.replaceWith(n)}function _r(e,n=document){if(e=O(e),!(e!=null&&e.href)||dt.indexOf(e.href)!==-1)return;const t=n.createElement("link");t.setAttribute("rel","prefetch"),t.setAttribute("href",e.href),t.setAttribute("as","document"),n.head.appendChild(t),dt.push(e.href)}const yr=_.curry(function(n,t){return _.pipe(ar(n),cr(n),sr(n))(t)});class yt extends Event{constructor(t){super("flow:loading:progress");y(this,"detail");this.detail=t}}class hr extends Event{constructor(t){super("flow:transition:out");y(this,"from");y(this,"to");y(this,"link");y(this,"transitionKey");y(this,"container");this.from=t.from,this.to=t.to,this.link=t.link,this.transitionKey=t.transitionKey,this.container=t.container}}class gr extends Event{constructor(t){super("flow:transition:in");y(this,"from");y(this,"to");y(this,"link");y(this,"transitionKey");y(this,"container");this.from=t.from,this.to=t.to,this.link=t.link,this.transitionKey=t.transitionKey,this.container=t.container}}class oe extends Event{constructor(t){super("flow:transition:end");y(this,"from");y(this,"to");y(this,"link");y(this,"transitionKey");y(this,"container");y(this,"error");this.from=t.from,this.to=t.to,this.link=t.link,this.transitionKey=t.transitionKey,this.container=t.container,this.error=t.error}}function br(){M.clear()}function ht(e){return e=O(e),!e||!M.has(e.href)?!0:M.delete(e.href)}function Ce(e,n,t,r=!1){const u=e.split(" ").filter(i=>!!i).concat(r?["(reduced)"]:[]).join(" ");l.transitions.set(u,{in:t,out:n})}Ce("* <=> *",Fe.out,Fe.in),Ce("* <=> *",Ne.out,Ne.in,!0);function gt(e,n,t){var u;if(l.state!=="end"&&l.state!=="error")return t&&t.preventDefault(),!1;const r=R();return r?(typeof e=="string"&&(e=O(e)),!!e&&Ue(e,r)&&(t?!(t.metaKey||t.ctrlKey):!0)?(t&&t.preventDefault(),ur(e,r)||((u=history==null?void 0:history.pushState)==null||u.call(history,{template:n},"",e.href),pt({state:{template:n}},t?lt(t==null?void 0:t.target):null)),!0):(!!e&&!Ue(e,r)&&(window.location.href=e.href),!1)):!1}function bt(){_.pipe(lr,_.map(qe))(document)}function vr(){return window.onload=()=>{Ot(),jr()},window.addEventListener("popstate",pt),l.previousTemplate=ke(document),l.previousURL=R(),{back:()=>{var e;return history?((e=history.back)==null||e.call(history),!0):!1},clearAllCache:br,clearCacheForUrl:ht,forward:()=>{var e;return history?((e=history.forward)==null||e.call(history),!0):!1},goToPage:(e,n)=>gt(e,n),rerunScript:qe,rerunScripts:bt,setTransition:Ce}}function vt(e){return n=>{if(!e)return;const t=O(e.getAttribute("href")),r=or(e);gt(t,r,n)}}function I(e){return()=>{!e||(_r(e.href),e.removeEventListener("mouseenter",I(e)),e.removeEventListener("focus",I(e)))}}async function pt({state:e},n=null){const t=l.previousTemplate||"*",r=l.previousURL||R(),u=(e==null?void 0:e.template)||"*",i=R(),o={view:B(document),template:t,url:r};l.state="out";const{transition:c,transitionKey:s}=pr(t,u),d={from:o,to:{template:u,url:i},link:n,transitionKey:s,container:z(document)};window.dispatchEvent(new hr(d)),Or(R()).then(async b=>{await c.out(d);const j={from:o,to:null,link:n,transitionKey:s,container:z(document),error:null};if(!b){console.error("No page founded"),l.state="error",window.dispatchEvent(new oe({...j,error:"No page founded"}));return}const L=ir(b).cloneNode(!0),F={...j,to:{document:L,container:z(L),view:B(L),template:u,url:R()}};try{yr(L,document)}catch(ze){l.state="error",window.dispatchEvent(new oe({...F,error:ze}));return}l.state="in",window.dispatchEvent(new gr(F)),await c.in(F),fr(document),l.state="end",window.dispatchEvent(new oe({...F,error:null})),l.previousTemplate=ke(document),l.previousURL=i,Ot(),bt()}).catch(b=>{l.state="error",window.dispatchEvent(new oe({...d,to:{...d.to,view:null},error:b})),console.error(b)})}function pr(e,n){var c;const t=ue(e,n),r=!!((c=window==null?void 0:window.matchMedia)!=null&&c.call(window,"(prefers-reduced-motion: reduce)").matches),u=`* <=> *${r?" (reduced)":""}`,i=t.find(s=>l.transitions.get(s))||u,o=i&&l.transitions.has(i)?l.transitions.get(i):l.transitions.has(u)?l.transitions.get(u):r?Ne:Fe;return{transitionKey:i,transition:o}}async function Or(e){return new Promise(async(n,t)=>{if(!e)return t();if(M.has(e.href)){const r=M.get(e.href),u=new TextEncoder().encode(r).length;return window.dispatchEvent(new yt({progress:1,cache:!0,done:!0,fullBytesLength:u,bytesReceived:u})),n(r)}if(T.has(e.href))try{return await T.get(e.href),n(M.get(e.href))}catch(r){return t(r)}try{T.set(e.href,fetch(e.href,{mode:"same-origin",method:"GET",headers:{"X-Requested-With":"self-navigation","X-flow":"1"},credentials:"same-origin"}).then(mr).then(i=>i instanceof Response?i:new Response(i,{headers:{"Content-Type":"text/html"}})));const r=await T.get(e.href);if(!r)throw new Error;const u=await r.text();if(T.delete(e.href),r.status>=200&&r.status<300)M.set(e.href,u);else return t({status:r.status});return n(u)}catch(r){return T.delete(e.href),ht(e),t(r)}})}function Ot(){$.forEach(e=>{e.removeEventListener("click",vt(e)),e.removeEventListener("mouseenter",I(e)),e.removeEventListener("focus",I(e))}),$.length=0,dr(document).forEach(e=>{$.push(e)}),$!=null&&$.length&&$.forEach(e=>{e.addEventListener("click",vt(e)),e.addEventListener("mouseenter",I(e)),e.addEventListener("focus",I(e))})}function jr(){var t;const e=R(),n=ke(document);(t=history==null?void 0:history.replaceState)==null||t.call(history,{template:n},"",e==null?void 0:e.href)}function mr(e){var u;if(!(e.status>=200&&e.status<300))return e;const n=(u=e.body)==null?void 0:u.getReader(),t=parseInt(e.headers.get("Content-Length")||"0");let r=0;return new ReadableStream({start(i){function o(){n==null||n.read().then(({done:c,value:s})=>{if(window.dispatchEvent(new yt({progress:t?_.divide(r,t):c?1:0,fullBytesLength:c?r:t,bytesReceived:r,cache:!1,done:c})),c){i.close();return}r+=(s==null?void 0:s.length)||0,i.enqueue(s),o()})}o()}})}return()=>{const e=vr();if(window){const n=window;n.flowtypus=e}return e}});
//# sourceMappingURL=flowtypus.umd.js.map
